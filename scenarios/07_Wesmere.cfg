#textdomain wesnoth-wov
# This scenario is intended to be medium difficulty.
[scenario]
    id=07_Wesmere
    name= _ "Wesmere"
    next_scenario=08_Foothills
    {WOV_MAP 07_Wesmere.map}
    {TURNS 40 40 40}
    {DEFAULT_SCHEDULE_DUSK} # It's autumn
    carryover_percentage=20
    carryover_add=yes

    {INTRO_AND_SCENARIO_MUSIC revelation.ogg elvish-theme.ogg}
    {EXTRA_SCENARIO_MUSIC silvan_sanctuary.ogg}
    {EXTRA_SCENARIO_MUSIC nunc_dimittis.ogg}

    [story]
        [part]
            background=story/trow_intro_02.jpg
            story= _ "The hunt continued across grassy stretches of the greatland. Prey on four legs, prey on two. All harvested in countless numbers. Finally, overburdened with the yield of the Hunt, Flight Gorlack returned to its Eyrie. The recently arrived Flight of Vladnir awaited them."
        [/part]
        [part]
            background={VLADNIR_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Vladnir")} + _ "I come with tidings, fellow Dominant. Half of Morogor makes ready for the journey here."
        [/part]
        [part]
            background={RESHAN_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Reshan")} + _ "That must not be.
Even now we have not the provisions for them.

Further, our saurians tell us there is a terrible season which afflicts the greatland.
Much of it will grow as lifelessly cold as the highest mountain peak.
This cold lasts several moons."
        [/part]
        [part]
            background={VLADNIR_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Vladnir")} + _ "Nothing will delay their coming.
All that before stirred one Flight against another, now drives them here."
        [/part]
        [part]
            background={GORLACK_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Gorlack")} + _ "Then their needs will be accomadated. I shall expand the Hunt as to meet them."
        [/part]
        [part]
            background={RESHAN_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Reshan")} + _ "Gorlack, you must reconsider this course, wholly. End the Hunt.

Elsewise... you doom this expedition by retreading the shameful path of Dominant Morogor."
        [/part]
        [part]
            background={GORLACK_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Gorlack")} + _ "I see your sense has yet to return, Reshan!

Dominant Morogor betrayed his own kith; attacked the very Drakes with whom he had sworn alliance!"
        [/part]
        [part]
            background={RESHAN_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Reshan")} + _ "They were not Drakes that he attacked...

Those allies Morogor betrayed were creatures of an alien kind.
Perhaps even the same kind our hunters now chase across the grassy flatlands.

I should long ago have spoken the whole of this Memory.
Yet I had concern it was more than you could believe by word alone."
        [/part]
        [part]
            background={GORLACK_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Gorlack")} + _ "Then your concern was well measured, for I disbelieve you even now.

Those creatures that graze upon the tall grass of the flatland,
that trick beasts to carry them across it,
that ride works of driftwood over the sea,
can be of no consequence to our affairs.

No Ancestor would mistake such <i>prey</i> for an ally."
        [/part]
        [part]
            background={VLADNIR_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Vladnir")} + _ "Your First Intendant speaks truth, Gorlack.

By the Honor of my Caste in whole, I hereby Proclaim it so."
        [/part]
        [part]
            background={RESHAN_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Reshan")} + _ "Dominant Vladnir... never since the Exiling has another caste verified our Spoken Memory."
        [/part]
        [part]
            background={VLADNIR_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Vladnir")} + _ "We were forbidden to do so.
Since the Time of Legend, we Clashers have been charged with the keeping of secrets...

The meandering way through the underland took by Parapathos in seeking the Council of Nine.
Makings for the mighty Automata down to their metal hearts that mix fire into water.
Witwegana's final words of affection to her mate before delaying Lenvan with a hopeless duel.

The wisdoms, the powers, the stories of our Ancestors.

These were once shared freely.
Until, anguished by our exile, Dominant Morogor forbade their telling.
Your Glider Caste alone would not comply.
By our Honor, we did.

Yet our written secrets quietly remained."
        [/part]
        [part]
            background={VLADNIR_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Vladnir")} + _ "Now, we are far beyond the Domain of Morogor; here his edicts hold no sway.
All that he made secret, I may share with you here."
        [/part]
        [part]
            background={GORLACK_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Gorlack")} + _ "Speak no more of your secrets.

You all clutch to your fragments of the past, dwell there with them.
Your Secrets...
Your Memories...
Despite these, endless time passed with every one of you failing to act!"
        [/part]
        [part]
            background={RESHAN_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Reshan")} + _ "... Gorlack, these clasher secrets may bear details lost to the Spoken Memory.
Without them I fear--"
        [/part]
        [part]
            background={RESHAN_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Reshan")} + _ "Speak no more of your fears!

So many challenges have we overcome.
So many foes vanquished.
Yet still you do not grasp how we shift the Winds of Fate by our Willful Action."
        [/part]
        [part]
            background={RESHAN_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Reshan")} + _ "The spoken memory tells us steady wings may catch the Winds of Fate--"
        [/part]
        [part]
            background={GORLACK_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Gorlack")} + _ "Nay.
Not merely tossed about by the winds.
We <b>shift</b> them.

We fumble not for a windpath.
We make it.

Feel the world as it should be with all the Fire of your Heart.
With no concern for how things have always been.
Then remake the world as it should become by your Willful Action.

Perhaps you need witness one final demonstration..."
        [/part]
        [part]
            background={GORLACK_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Gorlack")} + _ "I Call the Hunt.
A hunt greater than any before it.

Three Flights of Hunters.

I already signaled Karron to continue east across the Grassy Flatland.
Vladnir, you will depart southeast for the Warmsands.
I shall go northeast to the Sunreach Peaks.

Together we shall take meat enough for all of Morogor."
        [/part]
        [part]
            background={VLADNIR_PORTRAIT}
            scale_background=no
            story={CAPTION ( _ "Vladnir")} + _ "So it will be."
        [/part]
    [/story]
    {WOV_GC_TRACK {JOURNEY_07_NEW}}

    # wmllint: validate-off

    [side]
        side=1
        controller=human
        recruit=Drake Burner, Drake Clasher, Drake Fighter, Drake Glider, Saurian Augur, Saurian Skirmisher
        gold=250
        save_id=Player
        team_name=hero
        user_team_name= _ "Drakes"
        side_name= _ "Gorlack"
        {FLAG_VARIANT long}
        [leader]
            {GORLACK}
        [/leader]
        [unit]
            {RESHAN}
            placement=leader
        [/unit]
        [unit]
            {ARINEXIS}
            placement=leader
        [/unit]
        [unit]
            {ZEDRIX}
            placement=leader
        [/unit]
    [/side]
    {SECOND_INTENDANT_REPLACEMENT_EVENTS}
    {WOV_DEATHS}

    [side]
        side=2
        controller=ai
        defeat_condition=no_units_left
        recruit= Elvish Sorceress, Elvish Druid
        {GOLD 100 200 300}
        {INCOME 5 10 15}
        team_name=elves
        user_team_name= _ "Elves"
        {FLAG_VARIANT wood-elvish}
        [leader]
            id=Salennea
            name= _ "Salennea"
            type=Elvish Lady
        [/leader]
        [ai]
            ai_algorithm=idle_ai
        [/ai]
        {UNIT () (Elvish Sorceress) 32 13 ()}
        {UNIT () (Elvish Druid)     30 14 ()}
        {UNIT () (Elvish Shaman)    35 20 ()}
        {UNIT () (Elvish Shaman)    41 16 ()}
        [village]
            x,y=35,20
        [/village]
        [village]
            x,y=41,16
        [/village]
    [/side]

    [side]
        side=3
        controller=ai
        defeat_condition=no_units_left
        recruit=Jaguar
        {GOLD 100 100 100}
        {INCOME 8 8 8}
        team_name=wildcats
        user_team_name= _ "Ornery Pets"
        {FLAG_VARIANT wood-elvish}
        [leader]
            id=Princess Mew
            name= _ "Princess Mew"
            type=Jaguar
        [/leader]
        [ai]
            ai_algorithm=idle_ai
        [/ai]
        {UNIT () (Jaguar) 20 6 ()}
        {UNIT () (Jaguar) 22 5 ()}
    [/side]

    [side]
        side=4
        controller=ai
        defeat_condition=no_units_left
        recruit=Wose, Elder Wose, Wose Shaman
        {GOLD 100 200 300}
        {INCOME 5 10 15}
        team_name=elves
        user_team_name= _ "Woses"
        {FLAG_VARIANT wood-elvish}
        [leader]
            id=Gulladrumm
            name= _ "Gulladrumm"
            type=Ancient Wose
        [/leader]
        [ai]
            ai_algorithm=idle_ai
        [/ai]
        {UNIT () (Elder Wose)  37 6 ()}
        {UNIT () (Elder Wose)  38 7 ()}
        {UNIT () (Elder Wose)  36 7 ()}
        {UNIT () (Wose)        38 5 ()}
        {UNIT () (Wose)        38 8 ()}
        {UNIT () (Wose)        35 7 ()}
        {UNIT () (Wose)        38 2 ()}
        {UNIT () (Wose)        42 7 ()}
        {UNIT () (Wose)        31 7 ()}
        [village]
            x,y=38,2
        [/village]
        [village]
            x,y=42,7
        [/village]
        [village]
            x,y=31,7
        [/village]
    [/side]

    [side]
        side=5
        controller=ai
        defeat_condition=no_units_left
        recruit=Mermaid Initiate, Dolphin
        {GOLD 0 10 20}
        {INCOME 1 2 3}
        team_name=elves
        user_team_name= _ "Mermaids"
        {FLAG_VARIANT wood-elvish}
        [leader]
            id=Pelgara
            name= _ "Pelgara"
            type=Mermaid Enchantress
        [/leader]
        [ai]
            aggression=1.0
            leader_aggression=1.0
            ai_algorithm=idle_ai
        [/ai]
    [/side]

    [side]
        side=6
        controller=ai
        defeat_condition=no_units_left
        recruit= Elvish Hero, Elvish Ranger, Elvish Marksman, Elvish Rider
        {GOLD 100 200 300}
        {INCOME 5 10 15}
        team_name=elves
        user_team_name= _ "Elves"
        {FLAG_VARIANT wood-elvish}
        [leader]
            id=Vonel
            name= _ "Vonel"
            type=Elvish Marshal
        [/leader]
        [ai]
            ai_algorithm=idle_ai
        [/ai]
        {NAMED_UNIT () (Elvish Rider) 20 23 (Nomeon) ( _ "Nomeon") ()}
        # Guards inside Nomeon's border fort.
        {UNIT () (Elvish Archer)  18 17 ()}
        {UNIT () (Elvish Fighter) 18 20 ()}
        {UNIT () (Elvish Fighter) 17 20 ()}
        {UNIT () (Elvish Fighter) 15 19 ()}
        {UNIT () (Elvish Fighter) 16 19 ()}
        # Guards in watchtowers around the fort.
        {UNIT () (Elvish Archer)  14 14 ()}
        {UNIT () (Elvish Archer)  20 14 ()}
        {UNIT () (Elvish Archer)  23 18 ()}
        [village]
            x,y=14,14
        [/village]
        [village]
            x,y=20,14
        [/village]
        [village]
            x,y=23,18
        [/village]
    [/side]

    # wmllint: validate-on

    [event]
        name=prestart
        {MODIFY_UNIT side=1 facing ne}
        {MODIFY_UNIT side=2,3,4,5,6 facing sw}
        [objectives]
            [objective]
                description= _ "Harvest all prey."
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Gorlack"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Reshan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Arinexis"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Zedrix"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=20
            [/gold_carryover]
            [note]
                description= _ "Our saurian 'adviser' Arinexis informs us this prey will remain calm until attacked."
            [/note]
            [note]
                description= _ "This forest is poorly maintained, with an unusual amount of dry litter. Use of fire could ignite it.
Creatures standing in burning forest will suffer some injury (16 fire damage)."
            [/note]
        [/objectives]
    [/event]

    [event]
        name=start
        [message]
            speaker=Vonel
            image_pos=right
            mirror=yes
            message= _ "You monsters there, Halt! This is the sovereign realm of Wesmere. No further may you go."
        [/message]
        [move_unit]
            id=Salennea
            to_x=31, 28, 27, 17
            to_y=17, 18, 18, 23
        [/move_unit]
        [message]
            speaker=Vonel
            message= _ "Princess, I beg of you, walk not again into jeopardy!"
        [/message]
        [message]
            speaker=Salennea
            image_pos=right
            mirror=yes
            message= _ "Be silent, Vonel. For I am no mere “princess” awaiting your salvation; I am a Lady of Wesmere!"
        [/message]
        [message]
            speaker=Vonel
            message= _ {WHISPER "<small><i>you will always be a princess to me...</i></small>"}
        [/message]
        [message]
            speaker=Salennea
            image_pos=right
            mirror=yes
            message= _ "Your beastly sinews and steel tools of death do not impress me, Vonel, for my witful tongue and virtuous conscience are more than protection enough in any case I may find myself."
        [/message]
        [message]
            speaker=Arinexis
            message={WHISPER ("<i>...Shek’kahan, thisss iss the elvesss' soft underbelly I ssspoke of...</i>")}
        [/message]
        [message]
            speaker=Arinexis
            message= _ "Wise Salennea! We wish entry to your land to ssseek your counsssel. Grant uss thisss, Salennea the Jusst!"
        [/message]
        [message]
            speaker=Salennea
            image_pos=right
            mirror=yes
            message= _ "Ah, “Salennea the Just”. I shall weave this into the long twine of my existing titles...

“Wise Lady Salennea, the Just, Wielder of the Sapphire of Ice, the Embracer of Woses, the Merciful to Orcs, Keeper of Ca--"
        [/message]
        [message]
            speaker=Arinexis
            message= _ "Salennea! ... we grow weary of travel... and we go hungry!

<b>So Hungry.</b>"
        [/message]
        [message]
            speaker=Arinexis
            message= _ "Salennea, pray allow usss entry."
        [/message]
        [message]
            speaker=Vonel
            image_pos=right
            mirror=yes
            message= _ "Nay! This is a March of Wesmere, we shall not..."
        [/message]
        [message]
            speaker=Salennea
            image_pos=right
            mirror=yes
            message= _ "Marches only part us, Vonel.

Let all be welcome to Wesmere!"
        [/message]
        [move_unit]
            id=Salennea
            to_x=27, 28, 31, 31
            to_y=18, 18, 17, 14
        [/move_unit]
        [message]
            speaker=Salennea
            image_pos=right
            mirror=yes
            message= _ "This is my castle Saethrania--
the Castle of Sharing.

You may make an abode of castle Gliinoler--
the Castle of Caring.

My attendants will bestow whatever form of floral nourishment you most desire. Mayhap Bread of the Locust Fruit softed with Milk of the Hazel and Ichor of the Birch."
        [/message]
        {HIGHLIGHT_IMAGE 31 19 "items/gohere.png" ()}
        {REMOVE_IMAGE    31 19}
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=31,19
            id=Gorlack
        [/filter]
        [message]
            speaker=Zedrix
            image_pos=right
            mirror=yes
            message={WHISPER ( _ "By majestic blue glow of moon! Shek’kahan, you have thesse pixiesss in your teeth.")}
        [/message]
        [message]
            speaker=Arinexis
            message={WHISPER ( _ "Position your huntersss well and then let usss attack!")}
        [/message]
    [/event]

    [event]
        name=attack_end
        [filter]
            side=1
        [/filter]
        [message]
            speaker=Salennea
            image_pos=right
            mirror=yes
            message= _ "Nay! This is a thing too terrible to foresee. Vonel, save me from these dragons!"
        [/message]
        [message]
            speaker=Vonel
            message= _ "I am coming to save you, m'Lady!

Dispatch doves to the Ka’lian with word of our peril here!"
        [/message]
        [message]
            speaker=Nomeon
            image_pos=right
            mirror=yes
            message= _ "Lady Salennea loosed them to the wilds this morning for sake of their well being...

I shall bring word myself!"
        [/message]
        [move_unit]
            id=Nomeon
            to_x,to_y=34,33
        [/move_unit]
        [kill]
            id=Nomeon
            animate=no
        [/kill]
        [modify_side]
            [filter]
                team_name=elves
            [/filter]
            [ai]
                ai_algorithm=ai_default_rca
            [/ai]
        [/modify_side]
    [/event]

    [event]
        name=last_breath
        [filter]
            id=Salennea
        [/filter]
        [message]
            speaker=Salennea
            image_pos=right
            mirror=yes
            message= _ "You have slain me, Vonel. Your bias and slander against these gentle giants imbued them with a terrible yet justifiable wrath!"
        [/message]
        [message]
            speaker=Vonel
            message= _ "If only I had listened to you, my Lady... <small><i>my princess</i></small> ...

Naaaaaaaay!"
        [/message]
    [/event]

    [event]
        name=victory
        [message]
            speaker=Gorlack
            message= _ "Flight, spread forth.
Seize all this forest offers us.

We shall regather to the sunreach peaks."
        [/message]
    [/event]

    [event]
        name=attack end
        first_time_only=no
        [filter_attack]
            name=fire breath
        [/filter_attack]
        [filter_second]
            [filter_location]
                terrain=*^F*
            [/filter_location]
        [/filter_second]
        # place fire
        [item]
            x,y=$x2,$y2
            halo=scenery/flames[01~15].png:100
            name=forest fire
        [/item]
    [/event]

    [event]
        name=attack end
        first_time_only=no
        [filter_second_attack]
            name=fire breath
        [/filter_second_attack]
        [filter]
            [filter_location]
                terrain=*^F*
            [/filter_location]
        [/filter]
        # place fire
        [item]
            x,y=$x1,$y1
            halo=scenery/flames[01~15].png:100
            name=forest fire
        [/item]
    [/event]

    [event]
        name=side 1 turn refresh
        first_time_only=no
        [store_items]
            variable=current_fires
            item_name=forest fire
        [/store_items]
        # store all locations with trees that are adjacent to a current fire
        [store_locations]
            terrain=*^F*
            [and]
                find_in=current_fires
                radius=1
            [/and]
            [not]
                find_in=current_fires
            [/not]
            variable=new_fires
        [/store_locations]
        # burn units sitting on existing fires
        [if]
            [then]
                [harm_unit]
                    [filter]
                        [filter_location]
                            find_in=current_fires
                        [/filter_location]
                    [/filter]
                    amount=16
                    damage_type=fire
                    fire_event=yes
                    animate=yes
                [/harm_unit]
            [/then]
        [/if]
        # burn out existing fires, replace trees with dirt
        [terrain]
            find_in=current_fires
            terrain=Rb
        [/terrain]
        [remove_item]
            image=forest fire
        [/remove_item]
        # spread fire to adjacent locations
        [item]
            find_in=new_fires
            halo=scenery/flames[01~15].png:100
            name=forest fire
        [/item]
        {CLEAR_VARIABLE current_fires,new_fires}
    [/event]
[/scenario]
